<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktdsuniversity.edu.pms.approval.dao.ApprovalDetailDao">
	
	<resultMap type="com.ktdsuniversity.edu.pms.approval.vo.ApprovalDetailVO" id="approvalVoMap" autoMapping="true">
		<id column="APPR_DTL_ID" property="apprDtlId"/>
		<association property="employeeVO" javaType="com.ktdsuniversity.edu.pms.employee.vo.EmployeeVO">
            <id column="EMP_ID" property="empId"/>
            <result column="EMP_NAME" property="empName"/>
            <result column="PRFL" property="prfl"/>
        </association>
		<association property="approvalVO" javaType="com.ktdsuniversity.edu.pms.approval.vo.ApprovalVO">
			<id column="APPR_ID" property="apprId"/>
			<result column="APPR_ID" property="apprId"/>
		</association>
		<association property="productVO" javaType="com.ktdsuniversity.edu.pms.product.vo.ProductVO">
			<id column="PRDT_ID" property="prdtId"/>
			<result column="PRDT_NAME" property="prdtName"/>
		</association>
	</resultMap>
	
	<select id="getAllApprovalDetail" resultType="com.ktdsuniversity.edu.pms.approval.vo.ApprovalDetailVO">
  		SELECT APPR_DTL_ID 
  			 ,APPR_ID 
  			 ,PRDT_ID 
  			 ,CUR_STR
  			 ,DEL_YN
			FROM APPROVAL_DETAIL
			WHERE DEL_YN='N'
  	</select>
  	
  	
  	
  	<insert id="insertApproval" parameterType="com.ktdsuniversity.edu.pms.approval.dao.ApprovalDao">
  		INSERT INTO APPROVAL_DETAIL
			(APPR_DTL_ID 
			,APPR_ID 
			,PRDT_ID 
			,CUR_STR 
			,DEL_YN)
			VALUES(
			#{apprDtlId}
			,#{apprId} 
			,#{prdtId}
			,#{curStr} 
			'N'	);  		
  	</insert>
  	

  	<select id="getpersonApproval"  parameterType="string" resultMap="approvalVoMap">
  		SELECT 
			ad.APPR_ID 
			,ad.PRDT_ID
			,ad.CUR_STR
			,p.PRDT_NAME 
			FROM APPROVAL_DETAIL ad
			INNER JOIN APPROVAL a   
			ON ad.APPR_ID = a.APPR_ID
			INNER JOIN EMPLOYEE e 
			ON e.EMP_ID =a.DMD_ID
			INNER JOIN PRODUCT p 
			ON p.PRDT_ID =ad.PRDT_ID 
			WHERE a.DEL_YN = 'N'
			AND ad.APPR_ID= #{_parameter}
  	</select>
  	
  	
	
  	
  	
  	
  	
  	
  	
  	
</mapper>